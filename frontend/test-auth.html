<!DOCTYPE html>
<html>
  <head>
    <title>Test Google Auth</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }
      .login-button {
        background-color: #4285f4;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 20px 0;
      }
      .profile-container {
        display: none;
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>Test Google Authentication</h1>

    <button class="login-button" onclick="loginWithGoogle()">
      Login with Google
    </button>

    <div id="profile" class="profile-container">
      <h2>Profile Information</h2>
      <pre id="profile-data"></pre>
    </div>

    <script>
      function loginWithGoogle() {
        window.location.href = "http://localhost:3000/api/auth/google";
      }

      // Verificar si hay un token en la URL (despu√©s del callback)
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get("token");

        if (token) {
          localStorage.setItem("jwt_token", token);
          fetchProfile(token);
        }
      };

      async function fetchProfile(token) {
        try {
          const response = await fetch(
            "http://localhost:3000/api/auth/profile",
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (response.ok) {
            const profile = await response.json();
            document.getElementById("profile").style.display = "block";
            document.getElementById("profile-data").textContent =
              JSON.stringify(profile, null, 2);
          }
        } catch (error) {
          console.error("Error fetching profile:", error);
        }
      }
    </script>
  </body>
</html>
